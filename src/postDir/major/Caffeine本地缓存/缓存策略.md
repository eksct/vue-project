Caffeineæä¾›äº†å››ç§ç¼“å­˜æ·»åŠ ç­–ç•¥ï¼šæ‰‹åŠ¨åŠ è½½ï¼Œè‡ªåŠ¨åŠ è½½ï¼Œæ‰‹åŠ¨å¼‚æ­¥åŠ è½½å’Œè‡ªåŠ¨å¼‚æ­¥åŠ è½½ã€‚
### æ‰‹åŠ¨åŠ è½½
```java
Cache<Key, Graph> cache = Caffeine.newBuilder()
    .expireAfterWrite(10, TimeUnit.MINUTES)
    .maximumSize(10_000)
    .build();

// æŸ¥æ‰¾ä¸€ä¸ªç¼“å­˜å…ƒç´ ï¼Œ æ²¡æœ‰æŸ¥æ‰¾åˆ°çš„æ—¶å€™è¿”å›null
Graph graph = cache.getIfPresent(key);
// æŸ¥æ‰¾ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨åˆ™ç”Ÿæˆç¼“å­˜å…ƒç´ ,  å¦‚æœæ— æ³•ç”Ÿæˆåˆ™è¿”å›null
graph = cache.get(key, k -> createExpensiveGraph(key));
// æ·»åŠ æˆ–è€…æ›´æ–°ä¸€ä¸ªç¼“å­˜å…ƒç´ 
cache.put(key, graph);
// ç§»é™¤ä¸€ä¸ªç¼“å­˜å…ƒç´ 
cache.invalidate(key);
```
`Cache`Â æ¥å£æä¾›äº†æ˜¾å¼æœç´¢æŸ¥æ‰¾ã€æ›´æ–°å’Œç§»é™¤ç¼“å­˜å…ƒç´ çš„èƒ½åŠ›ã€‚
æ¨èä½¿ç”¨`cache.get(key, k -> value)`æ“ä½œæŸ¥æ‰¾ç¼“å­˜å…ƒç´ ï¼Œç¼“å­˜ä¸­ä¸å­˜åœ¨keyå¯¹åº”çš„ç¼“å­˜å…ƒç´ æ—¶ä¼šç”Ÿæˆç¼“å­˜å…ƒç´ å¹¶å†™å…¥ã€‚æœ‰å¯èƒ½è¿”å›`null`ï¼›
`cache.put(key, value)`æ“ä½œä¼šè¦†ç›–keyæ‰€å¯¹åº”çš„ç¼“å­˜å…ƒç´ ã€‚
### è‡ªåŠ¨åŠ è½½
```java
LoadingCache<Key, Graph> cache = Caffeine.newBuilder()
    .maximumSize(10_000)
    .expireAfterWrite(10, TimeUnit.MINUTES)
    .build(key -> createExpensiveGraph(key));

// æŸ¥æ‰¾ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨åˆ™ç”Ÿæˆç¼“å­˜å…ƒç´ ,  å¦‚æœæ— æ³•ç”Ÿæˆåˆ™è¿”å›null
Graph graph = cache.get(key);
// æ‰¹é‡æŸ¥æ‰¾ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨åˆ™ç”Ÿæˆç¼“å­˜å…ƒç´ 
Map<Key, Graph> graphs = cache.getAll(keys);
```
`LoadingCache`æ˜¯ä¸€ä¸ª`Cache`Â é™„åŠ ä¸ŠÂ `CacheLoader`èƒ½åŠ›ä¹‹åçš„ç¼“å­˜å®ç°ã€‚
é€šè¿‡Â `getAll`å¯ä»¥è¾¾åˆ°æ‰¹é‡æŸ¥æ‰¾ç¼“å­˜çš„ç›®çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨`getAll`Â æ–¹æ³•ä¸­ï¼Œä¼šå¯¹ä¸å­˜åœ¨ç¼“å­˜çš„keyè°ƒç”¨ä¸€æ¬¡`CacheLoader.load`Â æ¥ç”Ÿæˆç¼“å­˜å…ƒç´ ã€‚
åœ¨æ‰¹é‡æ£€ç´¢æ¯”å•ä¸ªæŸ¥æ‰¾æ›´æœ‰æ•ˆç‡çš„åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥è¦†ç›–å¹¶å¼€å‘`CacheLoader.loadAll`Â æ–¹æ³•æ¥ä½¿ä½ çš„ç¼“å­˜æ›´æœ‰æ•ˆç‡ã€‚
### æ‰‹åŠ¨å¼‚æ­¥åŠ è½½
```java
AsyncCache<Key, Graph> cache = Caffeine.newBuilder()
    .expireAfterWrite(10, TimeUnit.MINUTES)
    .maximumSize(10_000)
    .buildAsync();

// æŸ¥æ‰¾ä¸€ä¸ªç¼“å­˜å…ƒç´ ï¼Œ æ²¡æœ‰æŸ¥æ‰¾åˆ°çš„æ—¶å€™è¿”å›null
CompletableFuture<Graph> graph = cache.getIfPresent(key);
// æŸ¥æ‰¾ç¼“å­˜å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¼‚æ­¥ç”Ÿæˆ
graph = cache.get(key, k -> createExpensiveGraph(key));
// æ·»åŠ æˆ–è€…æ›´æ–°ä¸€ä¸ªç¼“å­˜å…ƒç´ 
cache.put(key, graph);
// ç§»é™¤ä¸€ä¸ªç¼“å­˜å…ƒç´ 
cache.synchronous().invalidate(key);
```
`AsyncCache`Â æ˜¯Â `Cache`Â çš„ä¸€ä¸ªå˜ä½“ï¼Œ`AsyncCache`å¯ä»¥äº†åœ¨Â [Executor](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/Executor.html)ä¸Šç”Ÿæˆç¼“å­˜å…ƒç´ å¹¶è¿”å›Â [CompletableFuture](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html)ã€‚è¿™æ ·åœ¨å“åº”å¼ç¼–ç¨‹æ¨¡å‹ä¸­ä¹Ÿå¯ä»¥åˆ©ç”¨ç¼“å­˜ã€‚
`synchronous()`æ–¹æ³•ä¼šé˜»å¡å¹¶ç›´åˆ°å¼‚æ­¥ç¼“å­˜ç”Ÿæˆå®Œæ¯•ã€‚
é»˜è®¤çš„çº¿ç¨‹æ± å®ç°æ˜¯Â [ForkJoinPool.commonPool()](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ForkJoinPool.html)Â ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡è¦†ç›–å¹¶å®ç°Â `Caffeine.executor(Executor)`æ–¹æ³•æ¥è‡ªå®šä¹‰ä½ çš„çº¿ç¨‹æ± é€‰æ‹©ã€‚
### è‡ªåŠ¨å¼‚æ­¥åŠ è½½
```java
AsyncLoadingCache<Key, Graph> cache = Caffeine.newBuilder()
    .maximumSize(10_000)
    .expireAfterWrite(10, TimeUnit.MINUTES)
    // ä½ å¯ä»¥é€‰æ‹©: å»å¼‚æ­¥çš„å°è£…ä¸€æ®µåŒæ­¥æ“ä½œæ¥ç”Ÿæˆç¼“å­˜å…ƒç´ 
    .buildAsync(key -> createExpensiveGraph(key));
    // ä½ ä¹Ÿå¯ä»¥é€‰æ‹©: æ„å»ºä¸€ä¸ªå¼‚æ­¥ç¼“å­˜å…ƒç´ æ“ä½œå¹¶è¿”å›ä¸€ä¸ªfuture
    .buildAsync((key, executor) -> createExpensiveGraphAsync(key, executor));

// æŸ¥æ‰¾ç¼“å­˜å…ƒç´ ï¼Œå¦‚æœå…¶ä¸å­˜åœ¨ï¼Œå°†ä¼šå¼‚æ­¥è¿›è¡Œç”Ÿæˆ
CompletableFuture<Graph> graph = cache.get(key);
// æ‰¹é‡æŸ¥æ‰¾ç¼“å­˜å…ƒç´ ï¼Œå¦‚æœå…¶ä¸å­˜åœ¨ï¼Œå°†ä¼šå¼‚æ­¥è¿›è¡Œç”Ÿæˆ
CompletableFuture<Map<Key, Graph>> graphs = cache.getAll(keys);
```
ä¸è‡ªåŠ¨åŠ è½½ç±»ä¼¼
ğŸ‘‡åŸæ–‡æ¥è‡ªgithubæ–‡æ¡£
ä¸€ä¸ªÂ `AsyncLoadingCache`æ˜¯ä¸€ä¸ªÂ `AsyncCache`Â åŠ ä¸ŠÂ `AsyncCacheLoader`èƒ½åŠ›çš„å®ç°ã€‚

åœ¨éœ€è¦åŒæ­¥çš„æ–¹å¼å»ç”Ÿæˆç¼“å­˜å…ƒç´ çš„æ—¶å€™ï¼Œ`CacheLoader`æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚è€Œåœ¨å¼‚æ­¥ç”Ÿæˆç¼“å­˜çš„åœºæ™¯ä¸‹ï¼ŒÂ `AsyncCacheLoader`åˆ™æ˜¯æ›´åˆé€‚çš„é€‰æ‹©å¹¶ä¸”å®ƒä¼šè¿”å›ä¸€ä¸ªÂ [CompletableFuture](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html)ã€‚

é€šè¿‡Â `getAll`å¯ä»¥è¾¾åˆ°æ‰¹é‡æŸ¥æ‰¾ç¼“å­˜çš„ç›®çš„ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨`getAll`Â æ–¹æ³•ä¸­ï¼Œå°†ä¼šå¯¹æ¯ä¸ªä¸å­˜åœ¨å¯¹åº”ç¼“å­˜çš„keyè°ƒç”¨ä¸€æ¬¡Â `AsyncCacheLoader.asyncLoad`Â æ¥ç”Ÿæˆç¼“å­˜å…ƒç´ ã€‚ åœ¨æ‰¹é‡æ£€ç´¢æ¯”å•ä¸ªæŸ¥æ‰¾æ›´æœ‰æ•ˆç‡çš„åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥è¦†ç›–å¹¶å¼€å‘`AsyncCacheLoader.asyncLoadAll`Â æ–¹æ³•æ¥ä½¿ä½ çš„ç¼“å­˜æ›´æœ‰æ•ˆç‡ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡å®ç°ä¸€ä¸ªÂ `AsyncCacheLoader.asyncLoadAll`å¹¶åœ¨å…¶ä¸­ä¸ºæ²¡æœ‰åœ¨å‚æ•°ä¸­è¯·æ±‚çš„keyä¹Ÿç”Ÿæˆå¯¹åº”çš„ç¼“å­˜å…ƒç´ ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œå¦‚æœå¯¹åº”æŸä¸ªkeyç”Ÿæˆçš„ç¼“å­˜å…ƒç´ ä¸åŒ…å«è¿™ä¸ªkeyçš„ä¸€ç»„é›†åˆå‰©ä½™çš„keyæ‰€å¯¹åº”çš„å…ƒç´ ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨`asyncLoadAll`ä¸­ä¹Ÿå¯ä»¥åŒæ—¶åŠ è½½å‰©ä¸‹çš„keyå¯¹åº”çš„å…ƒç´ åˆ°ç¼“å­˜å½“ä¸­ã€‚