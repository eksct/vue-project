读取缓存前先判断key**可能存在**或**一定不存在**。可以设置误判率。
可以先把存在的key存入过滤器也可以即时缓存(过滤器判断可能存在，但是缓存中没有。)查询数据库后将查询到的加入缓存和过滤器。

**缓存穿透** = 用户频繁请求数据库和缓存中都没有的数据 → 每次都打到数据库。
布隆过滤器可以防止这个问题。判断不存在时直接结束。
# 原理

布隆过滤器（**Bloom Filter**）是一种**空间效率极高的概率型数据结构**，主要用于**判断一个元素是否存在于集合中**，具有：

- ✅ **高效判断存在性**
- ❌ **可能误判“存在”，但绝不会误判“不存在”**

**布隆过滤器的核心由位图、多个哈希函数组成。

位图由一个长度为m的bit数组，初始值为0，插入元素并对元素进行多函数哈希后，会对相应的下标bit位置置1

当插入元素时，使用K个哈希函数对插入的字符串哈希出k个位置后将bit数组中这三个位置置为1

查询元素时，对插入内容哈希，若哈希后的位置均为1，则元素**可能存在**，若任意为0，则**不可能存在**。
毕竟哈希是会存在相同值的，所以是可能存在，而一旦查询key某个元素为0，那说明这玩意压根没在过滤器里。
所以是存在误判的可能性的。
# Guava 实现布隆过滤器（本地）

适用于：**单机服务、本地缓存、轻量级场景**
### ✅ 引入依赖

```xml
`<dependency>   
	<groupId>com.google.guava</groupId>
	<artifactId>guava</artifactId>
	<version>32.1.3-jre</version> 
</dependency>`
```

---

### ✅ 使用示例

```java
import com.google.common.hash.BloomFilter;
import com.google.common.hash.Funnels;

import java.nio.charset.StandardCharsets;

public class GuavaBloomDemo {

    public static void main(String[] args) {
        // 期望插入数 100000，误判率 1%
        BloomFilter<String> bloomFilter = BloomFilter.create(
                Funnels.stringFunnel(StandardCharsets.UTF_8),
                100_000,
                0.01
        );

        // 添加数据
        bloomFilter.put("user:123");
        bloomFilter.put("user:456");

        // 查询
        System.out.println(bloomFilter.mightContain("user:123"));  // true
        System.out.println(bloomFilter.mightContain("user:999"));  // false (或小概率 true)
    }
}
```

---

### ✅ 优缺点

|优点|缺点|
|---|---|
|使用简单，性能高|单机内存，不支持分布式|
|可控误判率，支持泛型|重启后数据丢失|
# ✅ 二、Redis 实现布隆过滤器（分布式）

### Redisson BloomFilter（基于 Redis 实现）
**适用于：Spring Boot 服务，跨服务共享布隆过滤器***
**引入Redisson
```xml
<dependency>
  <groupId>org.redisson</groupId>
  <artifactId>redisson-spring-boot-starter</artifactId>
  <version>3.23.2</version>
</dependency>

```
**配置 `application.yml`
```yaml
redisson:
  config: |
    singleServerConfig:
      address: "redis://127.0.0.1:6379"

```
or
```java
Config config = new Config();
config.useSingleServer()
      .setAddress("redis://127.0.0.1:6379")
      .setDatabase(0);

RedissonClient redissonClient = Redisson.create(config);

```
示例：
```java
import org.redisson.api.RBloomFilter;
import org.redisson.api.RedissonClient;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class RedisBloomService {

    @Autowired
    private RedissonClient redissonClient;

    public void initFilter() {
        RBloomFilter<String> bloomFilter = redissonClient.getBloomFilter("user:filter");
        // 初始化：预计元素数、误判率
        bloomFilter.tryInit(1000000L, 0.01);
    }

    public void add(String userId) {
    //向过滤器添加元素
        RBloomFilter<String> bloomFilter = redissonClient.getBloomFilter("user:filter");
        bloomFilter.add(userId);
    }

    public boolean mightExist(String userId) {
        RBloomFilter<String> bloomFilter = redissonClient.getBloomFilter("user:filter");
        return bloomFilter.contains(userId);
    }
}

```
